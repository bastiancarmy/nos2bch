window.nostr={_requests:{},_pubkey:null,async getPublicKey(){return this._pubkey?this._pubkey:(this._pubkey=await this._call("getPublicKey",{}),this._pubkey)},async signEvent(o){return this._call("signEvent",{event:o})},async getRelays(){return{}},nip04:{async encrypt(o,t){return window.nostr._call("nip04.encrypt",{peer:o,plaintext:t})},async decrypt(o,t){return window.nostr._call("nip04.decrypt",{peer:o,ciphertext:t})}},nip44:{async encrypt(o,t){return window.nostr._call("nip44.encrypt",{peer:o,plaintext:t})},async decrypt(o,t){return window.nostr._call("nip44.decrypt",{peer:o,ciphertext:t})}},_call(o,t){let r=Math.random().toString().slice(-4);return console.log("%c[nos2bch:%c"+r+"%c]%c calling %c"+o+"%c with %c"+JSON.stringify(t||{}),"background-color:#f1b912;font-weight:bold;color:white","background-color:#f1b912;font-weight:bold;color:#a92727","background-color:#f1b912;color:white;font-weight:bold","color:auto","font-weight:bold;color:#08589d;font-family:monospace","color:auto","font-weight:bold;color:#90b12d;font-family:monospace"),new Promise((e,c)=>{this._requests[r]={resolve:e,reject:c},window.postMessage({id:r,ext:"nos2bch",type:o,params:t},"*")})}};window.addEventListener("message",o=>{if(!(!o.data||o.data.response===null||o.data.response===void 0||o.data.ext!=="nos2bch"||!window.nostr._requests[o.data.id])){if(o.data.response.error){let t=new Error("nos2bch: "+o.data.response.error.message);t.stack=o.data.response.error.stack,window.nostr._requests[o.data.id].reject(t)}else window.nostr._requests[o.data.id].resolve(o.data.response);console.log("%c[nos2bch:%c"+o.data.id+"%c]%c result: %c"+JSON.stringify(o?.data?.response||o?.data?.response?.error?.message||{}),"background-color:#f1b912;font-weight:bold;color:white","background-color:#f1b912;font-weight:bold;color:#a92727","background-color:#f1b912;color:white;font-weight:bold","color:auto","font-weight:bold;color:#08589d"),delete window.nostr._requests[o.data.id]}});var n=null;document.addEventListener("mousedown",a);async function a(o){if(o.target.tagName!=="A"||!o.target.href.startsWith("nostr:")||n===!1)return;let t=await window.nostr._call("replaceURL",{url:o.target.href});if(t===!1){n=!1;return}o.target.href=t}
